version: "3.0"
    
services:
  node-red:
    build: ./agrarian/build 
    networks: 
        - node-red-net
    volumes:
        - ./agrarian/build/node-red-data:/root/.node-red
    ports: 
        - 1880:1880
  
    
  mosquitto:
    build: ./mosquitto/build
    networks: 
        - node-red-net
    ports: 
        - 1883:1883
  
  mongo-db:
    image: mongo:4.2.8-bionic
    volumes: 
        - ./mongo/build/mongo-db:/data/db   
    networks: 
        - node-red-net
    ports: 
        - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: microTUSH77
        
  webhook:
    image: staticfloat/docker-webhook
    volumes:
        # Mount this code into /code
        - ./:/code
        # Mount the docker socket
        - /var/run/docker.sock:/var/run/docker.sock
    environment:
        - WEBHOOK_SECRET=hook_secret
        - WEBHOOK_HOOKS_DIR=/code/hooks
        - WEBHOOK_BRANCH_LIST=test
    deploy:
        restart_policy:
            condition: unless-stopped
            delay: 10s
            max_attempts: 3
            window: 120s
    expose:
        - 8000
         
networks:
    node-red-net: