version: "2.0"

networks:
  node-red-net:
    driver: bridge 

services:
  node-red:
    container_name: node-red-agrarian
    hostname: node-red-agrarian
    build: ./agrarian/build 
    networks: 
        - node-red-net
    volumes:
        - ./agrarian/build/node-red-data:/root/.node-red
    ports: 
        - 1880:1880
  
    
  mosquitto:
    container_name: mosquitto-broker
    hostname: mqtt-broker
    build: ./mosquitto/build
    networks: 
        - node-red-net
    ports: 
        - 1883:1883
  
  mongo-db:
    container_name: mongo_db
    hostname: mongo
    image: mongo:4.2.8-bionic
    volumes: 
        - ./mongo/build/mongo-db:/data/db   
    networks: 
        - node-red-net
    ports: 
        - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: ricoTUSH77

  webhook:
    restart: unless-stopped
    image: staticfloat/docker-webhook
    volumes:
        # Mount this code into /code
        - ./:/code
        # Mount the docker socket
        - /var/run/docker.sock:/var/run/docker.sock
    environment:
        - WEBHOOK_SECRET=hook_secret
        - WEBHOOK_HOOKS_DIR=/code
        - WEBHOOK_BRANCH_LIST=test
    expose:
        - 8000