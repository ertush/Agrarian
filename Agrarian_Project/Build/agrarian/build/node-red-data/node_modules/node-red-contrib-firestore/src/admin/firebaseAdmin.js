const FirebaseAdminNode = require('./firebaseAdminNode');
var RJSON = require('relaxed-json')

module.exports = function (RED) {
  class FirebaseAdminConfig {
    constructor(n) {
      RED.nodes.createNode(this, n);

      try {
        this.configurationData = RJSON.parse(this.credentials.configurationData);
        console.log(this.configurationData)
      } catch (e) {
        this.error(`Bad configuration data`)
      }

      const firebaseAdminNode = new FirebaseAdminNode(this);
      this.core = firebaseAdminNode.core;
      this.database = firebaseAdminNode.database;
      this.firestore = firebaseAdminNode.firestore;
      this.on('close', firebaseAdminNode.onClose);
    }
  }

  RED.nodes.registerType("firebase admin", FirebaseAdminConfig, {
    credentials: {
      configurationData: {type: "text"}
    }
  });
}
